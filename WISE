
WISE catalog tests

Grab the Dec	-0.363600 < dec <= 2.225200 stripe,
http://irsadist.ipac.caltech.edu/wise-allsky/

Column descriptions here,
http://wise2.ipac.caltech.edu/docs/release/allsky/expsup/sec2_2a.html


echo "# desc ra dec sigra sigdec sigradec glon glat elon elat wx wy counter sourceid coaddid src w1mpro w1sigmpro w1snr w1rchi2 w2mpro w2sigmpro w2snr w2rchi2 w3mpro w3sigmpro w3snr w3rchi2 w4mpro w4sigmpro w4snr w4rchi2 rchi2 nb na w1sat w2sat w3sat w4sat satnum ccflags extflag varflag phqual detbit moonlev w1nm w1m w2nm w2m w3nm w3m w4nm w4m w1cov w2cov w3cov w4cov w1frtr w2frtr w3frtr w4frtr w1ccmap w1ccmagstr w2ccmap w2ccmapstr w3ccmap w3ccmapstr w4ccmap w4ccmapstr w1flux w1sigflux w1sky w1sigsky w1conf w2flux w2sigflux w2sky w2sigsky w2conf w3flux w3sigflux w3sky w3sigsky w3conf w4flux w4sigflux w4sky w4sigsky w4conf w1mag w1sigmag w1flag w1mcor w2mag w2sigmag w2flag w2mcor w3mag w3sigmag w3flag w3mcor w4mag w4sigmag w4flag w4mcor w1mag1 w1sigmag1 w1flag1 w2mag1 w2sigmag1 w2flag1 w3mag1 w3sigmag1 w3flag1 w4mag1 w4sigmag1 w4flag1 w1mag2 w1sigmag2 w1flag2 w2mag2 w2sigmag2 w2flag2 w3mag2 w3sigmag2 w3flag2 w4mag2 w4sigmag2 w4flag2 w1mag3 w1sigmag3 w1flag3 w2mag3 w2sigmag3 w2flag3 w3mag3 w3sigmag3 w3flag3 w4mag3 w4sigmag3 w4flag3 w1mag4 w1sigmag4 w1flag4 w2mag4 w2sigmag4 w2flag4 w3mag4 w3sigmag4 w3flag4 w4mag4 w4sigmag4 w4flag4 w1mag5 w1sigmag5 w1flag5 w2mag5 w2sigmag5 w2flag5 w3mag5 w3sigmag5 w3flag5 w4mag5 w4sigmag5 w4flag5 w1mag6 w1sigmag6 w1flag6 w2mag6 w2sigmag6 w2flag6 w3mag6 w3sigmag6 w3flag6 w4mag6 w4sigmag6 w4flag6 w1mag7 w1sigmag7 w1flag7 w2mag7 w2sigmag7 w2flag7 w3mag7 w3sigmag7 w3flag7 w4mag7 w4sigmag7 w4flag7 w1mag8 w1sigmag8 w1flag8 w2mag8 w2sigmag8 w2flag8 w3mag8 w3sigmag8 w3flag8 w4mag8 w4sigmag8 w4flag8 w1magp w1sigp1 w1sigp2 w1dmag w1ndf w1mlq w1mjdmin w1mjdmax w1mjdmean w2magp w2sigp1 w2sigp2 w2dmag w2ndf w2mlq w2mjdmin w2mjdmax w2mjdmean w3magp w3sigp1 w3sigp2 w3dmag w3ndf w3mlq w3mjdmin w3mjdmax w3mjdmean w4magp w4sigp1 w4sigp2 w4dmag w4ndf w4mlq w4mjdmin w4mjdmax w4mjdmean rho12 rho23 rho34 q12 q23 q34 xscprox w1rsemi w1ba w1pa w1gmap w1gerr w1gflg w2rsemi w2ba w2pa w2gmap w2gerr w2gflg w3rsemi w3ba w3pa w3gmap w3gerr w3gflg w4rsemi w4ba w4pa w4gmap w4gerr w4gflg tmasskey r2mass ra2mass n2mass jm2mass jmsig2mass hm2mass hmsig2mass km2mass kmsig2mass bestusectr ngrp x y z sptind" | cat - 


1 - desc ra dec sigra sigdec 
6 - sigradec glon glat elon elat wx wy counter sourceid coaddid src
17 - w1mpro w1sigmpro w1snr w1rchi2 w2mpro w2sigmpro w2snr w2rchi2 w3mpro w3sigmpro w3snr w3rchi2 w4mpro w4sigmpro w4snr w4rchi2
33 - rchi2 nb na w1sat w2sat w3sat w4sat satnum ccflags extflag varflag phqual detbit moonlev w1nm w1m w2nm w2m w3nm w3m w4nm w4m w1cov w2cov w3cov w4cov w1frtr w2frtr w3frtr w4frtr w1ccmap w1ccmagstr w2ccmap w2ccmapstr w3ccmap w3ccmapstr w4ccmap w4ccmapstr w1flux w1sigflux w1sky w1sigsky w1conf w2flux w2sigflux w2sky w2sigsky w2conf w3flux w3sigflux w3sky w3sigsky w3conf w4flux w4sigflux w4sky w4sigsky w4conf w1mag w1sigmag w1flag w1mcor w2mag w2sigmag w2flag w2mcor w3mag w3sigmag w3flag w3mcor w4mag w4sigmag w4flag w4mcor w1mag1 w1sigmag1 w1flag1 w2mag1 w2sigmag1 w2flag1 w3mag1 w3sigmag1 w3flag1 w4mag1 w4sigmag1 w4flag1 w1mag2 w1sigmag2 w1flag2 w2mag2 w2sigmag2 w2flag2 w3mag2 w3sigmag2 w3flag2 w4mag2 w4sigmag2 w4flag2 w1mag3 w1sigmag3 w1flag3 w2mag3 w2sigmag3 w2flag3 w3mag3 w3sigmag3 w3flag3 w4mag3 w4sigmag3 w4flag3 w1mag4 w1sigmag4 w1flag4 w2mag4 w2sigmag4 w2flag4 w3mag4 w3sigmag4 w3flag4 w4mag4 w4sigmag4 w4flag4 w1mag5 w1sigmag5 w1flag5 w2mag5 w2sigmag5 w2flag5 w3mag5 w3sigmag5 w3flag5 w4mag5 w4sigmag5 w4flag5 w1mag6 w1sigmag6 w1flag6 w2mag6 w2sigmag6 w2flag6 w3mag6 w3sigmag6 w3flag6 w4mag6 w4sigmag6 w4flag6 w1mag7 w1sigmag7 w1flag7 w2mag7 w2sigmag7 w2flag7 w3mag7 w3sigmag7 w3flag7 w4mag7 w4sigmag7 w4flag7 w1mag8 w1sigmag8 w1flag8 w2mag8 w2sigmag8 w2flag8 w3mag8 w3sigmag8 w3flag8 w4mag8 w4sigmag8 w4flag8 w1magp w1sigp1 w1sigp2 w1dmag w1ndf w1mlq w1mjdmin w1mjdmax w1mjdmean w2magp w2sigp1 w2sigp2 w2dmag w2ndf w2mlq w2mjdmin w2mjdmax w2mjdmean w3magp w3sigp1 w3sigp2 w3dmag w3ndf w3mlq w3mjdmin w3mjdmax w3mjdmean w4magp w4sigp1 w4sigp2 w4dmag w4ndf w4mlq w4mjdmin w4mjdmax w4mjdmean rho12 rho23 rho34 q12 q23 q34 xscprox w1rsemi w1ba w1pa w1gmap w1gerr w1gflg w2rsemi w2ba w2pa w2gmap w2gerr w2gflg w3rsemi w3ba w3pa w3gmap w3gerr w3gflg w4rsemi w4ba w4pa w4gmap w4gerr w4gflg tmasskey r2mass ra2mass n2mass jm2mass jmsig2mass hm2mass hmsig2mass km2mass kmsig2mass bestusectr ngrp x y z sptind


# dies... too much memory?
text2fits.py -H "$(cat wisecols)" -s "|" wise-allsky-cat-part27 wise-cat27.fits > w.log


gawk -F "|" 'BEGIN{OFS="|"} { print $2, $3, $4, $5, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32 }' wise-allsky-cat-part27 > wise-27-tag

text2fits.py -s "|" -H "ra dec dra ddec w1mpro w1sigmpro w1snr w1rchi2 w2mpro w2sigmpro w2snr w2rchi2 w3mpro w3sigmpro w3snr w3rchi2 w4mpro w4sigmpro w4snr w4rchi2" wise-27-tag wise-27-tag.fits

text2fits.py -s "|" -f "ddffffffffffffffffff" -H "ra dec dra ddec w1mpro w1sigmpro w1snr w1rchi2 w2mpro w2sigmpro w2snr w2rchi2 w3mpro w3sigmpro w3snr w3rchi2 w4mpro w4sigmpro w4snr w4rchi2" wise-27-tag wise-27-tag.fits




Forced photometry run on targets from Schlegel, 2013-04-18

svn rev 22604

python -u wise2.py -s stripe82-19objs.fits -o meas-s82-19objs-%03i-b.fits -P s82b -v --threads 8 --osources stripe82-19objs-meas.fits > w1b.log 2>&1 &
python -u wise2.py -p -r meas-s82-19objs-999-b.fits -m -P compare




#  Going to great lengths to avoid learning IDL:
# Evaluating Aaron's WISE PSF model on a grid:
git clone git://github.com/ameisner/WISE.git wise-psf

module load idl
module load idlutils
export WISE_DATA=$(pwd)/wise-psf/etc

(for ((y=50; y<1000; y+=100)); do
  for ((x=50; x<1000; x+=100)); do
    printf "psf = wise_psf_cutout(%d, %d, band=1, allsky=1)\n" $x $y
	printf "mwrfits, psf, 'wise-psf-w1-%d-%d.fits'\n" $x $y
  done
done) | (cd wise-psf/pro; idl)
ls wise-psf/pro/*.fits

(for ((y=50; y<1000; y+=100)); do
  for ((x=50; x<1000; x+=100)); do
    printf "psf = wise_psf_cutout(%d, %d, band=2, allsky=1)\n" $x $y
	printf "mwrfits, psf, 'wise-psf-w2-%d-%d.fits'\n" $x $y
  done
done) | (cd wise-psf/pro; idl)
ls wise-psf/pro/*.fits

# (for ((y=50; y<1000; y+=100)); do
#   for ((x=50; x<1000; x+=100)); do
#     printf "psf = wise_psf_cutout(%d, %d, band=1, allsky=1)\n" $x $y
# 	#printf "mwrfits, psf, 'wise-psf-w1-%03d-%03d.fits'\n" $x $y
#     printf "mwrfits, psf, 'wise-psf-w1.fits'\n" $x $y
#   done
# done) | (cd wise-psf/pro; idl)
# ls wise-psf/pro/*.fits




qsub -l "nodes=1:ppn=1" -l "walltime=2:00:00" -N w1 -o w1.log -q batch -t 0-50 ./runslice.py

qsub -l "nodes=1:ppn=1" -l "walltime=2:00:00" -N w2 -o w2b.log -q batch -t 50-53,59-100 ./runslice.py

qstat -n -1 -u dstn -t | less



At svn rev 22666:
qsub -l "nodes=1:ppn=1" -l "walltime=2:00:00" -N w1v2 -o w1v2.log -q batch -t 100-150 ./runslice.py


v3: rev 22670
qsub -l "nodes=1:ppn=1" -l "walltime=3:00:00" -N w1v3 -o w1v3.log -q batch -t 100-150 ./runslice.py
qsub -l "nodes=1:ppn=1" -l "walltime=3:00:00" -N w2v3 -o w2v3.log -q batch -t 200-250 ./runslice.py


v4: rev 22674
qsub -l "nodes=1:ppn=1" -l "walltime=3:00:00" -N w1v4 -o w1v4.log -q batch -t 100-190 ./runslice.py
qsub -l "nodes=1:ppn=1" -l "walltime=3:00:00" -N w2v4 -o w2v4.log -q batch -t 200-290 ./runslice.py

(I think v4 went into the targeting for special plates boss209 / 7027-7032)


v5: rev 22683  (ptsrc=True)

qsub -l "nodes=1:ppn=1" -l "walltime=3:00:00" -N w1v5 -o w1v5.log -q batch -t 100-190 ./runslice.py
qsub -l "nodes=1:ppn=1" -l "walltime=3:00:00" -N w2v5 -o w2v5.log -q batch -t 200-290 ./runslice.py




-----------------------------
Stripe 82 quasar test region:
-----------------------------
In leui of the copy jobs from IPAC for the WISE data still being in progress, I've put together
files for the QSO test region in stripe 82.  This is bounded by
   317 < RA < 330 deg
   0 < Dec < +1.25 deg

A file with all SDSS primary observations (RESOLVE_STATUS=SURVEY_PRIMARY)
are here:
   /clusterfs/riemann/raid000/bosswork/boss/wise1ext/sdss_stripe82
where the files are
   flist-eboss-stripe82.fits - SDSS field list
   objs-eboss-stripe82-dr8.fits - All photo parameters for SDSS primary objects, DR8 astrometry
   objs-eboss-stripe82-dr9.fits - All photo parameters for SDSS primary objects, DR9 astrometry

The WISE Level 1b images (all bands, 26 GB total) are in these two directories:
   /clusterfs/riemann/raid000/bosswork/boss/wise1test_stripe82/allsky
   /clusterfs/riemann/raid000/bosswork/boss/wise1test_stripe82/prelim_postcryo
Each directory has an index file of the files in that directory.

This should all be the same formats as what we did for the CFHT-W3 test region.
----

----
Re: W3 region:
----
This isn't quite the latest file, but Adam's file from a few days ago:
   http://faraday.uwyo.edu/~admyers/eBOSS/ancil-QSO-eBOSS-W3-ADM-dr8.fits
(and a copy on riemann.lbl.gov in our working directory on this).

W3BITMASK contains the merged target bits as follows:
     2^0: colorbox
     2^1: xdqsoz
     2^2: wise
     2^3 CFHTvar
     2^4: PTFvar
----


Coadds, and looking at WISE team's L1b frame inventory tables for quality metrics.

text2fits.py -H "scan_id frame_num moon_sep saa_sep ra dec mjd dtanneal w1zero w2zero w3zero w4zero rbovera noisepix r_mean_20 qual_frame qc_fact qi_fact qn_fact qa_fact qual_scan qs1_fact qs5_fact qp_fact" -f "sjdddddddddddddjddddjddd" wise_allsky.wise_allsky_4band_p1bs_frm14116.tbl wise-allsky-l1b-meta.fits

Trying IRSA's "program interface" -- need long timeouts on these!  Try text and xml outputs.
  wget --timeout 0 -q "http://irsa.ipac.caltech.edu/cgi-bin/Gator/nph-query?outfmt=1&spatial=NONE&catalog=wise_allsky_4band_p1bs_frm" &
  wget --timeout 0 -q "http://irsa.ipac.caltech.edu/cgi-bin/Gator/nph-query?outfmt=3&spatial=NONE&catalog=wise_allsky_4band_p1bs_frm" &
  wget --timeout 0 -q "http://irsa.ipac.caltech.edu/cgi-bin/Gator/nph-query?outfmt=3&spatial=NONE&catalog=wise_allsky_3band_p1bs_frm" &
  wget --timeout 0 -q "http://irsa.ipac.caltech.edu/cgi-bin/Gator/nph-query?outfmt=1&spatial=NONE&catalog=wise_allsky_3band_p1bs_frm" &
  wget --timeout 0 -q "http://irsa.ipac.caltech.edu/cgi-bin/Gator/nph-query?outfmt=3&spatial=NONE&catalog=wise_allsky_2band_p1bs_frm" &
  wget --timeout 0 -q "http://irsa.ipac.caltech.edu/cgi-bin/Gator/nph-query?outfmt=1&spatial=NONE&catalog=wise_allsky_2band_p1bs_frm" &


